##### Формула включений и исключений. Альтернативная формулировка на языке объектов и их свойств. Задача о беспорядках.
----
Формула включений и исключений (ФВИ)

Формулировка:  
Для конечных множеств $A_1, A_2, \ldots, A_n$:
$$
\left| \bigcup_{i=1}^n A_i \right| = \sum_{i=1}^n |A_i| - \sum_{1 \leq i < j \leq n} |A_i \cap A_j| + \ldots + (-1)^{n+1} |A_1 \cap \ldots \cap A_n|.
$$

Интуиция:  
Суммируются мощности отдельных множеств, вычитаются пересечения пар, добавляются пересечения троек и так далее, чтобы избежать двойного учёта.

Альтернативная формулировка через объекты и свойства

Контекст:  
Пусть имеется множество объектов $U$, и каждому объекту могут быть приписаны свойства $P_1, P_2, \ldots, P_n$.  
Обозначим через $N(S)$ количество объектов, обладающих всеми свойствами из подмножества $S \subseteq \{P_1, \ldots, P_n\}$.

Формула:  
Количество объектов, не обладающих ни одним из свойств:
$$
N(\emptyset) = |U| - \sum_{i=1}^n N(\{P_i\}) + \sum_{1 \leq i < j \leq n} N(\{P_i, P_j\}) - \ldots + (-1)^n N(\{P_1, \ldots, P_n\}).
$$

Пример:  
В группе из 100 человек:
- 40 знают Python ($P_1$),
- 30 знают Java ($P_2$),
- 20 знают оба языка ($P_1 \cap P_2$).

Количество людей, не знающих ни Python, ни Java:
$$
N(\emptyset) = 100 - (40 + 30) + 20 = 50.
$$

Задача о беспорядках (Derangements)

Определение:  
Беспорядок — это перестановка элементов, в которой ни один элемент не остаётся на своём месте.  
Обозначение: $D_n$ — число беспорядков для $n$ элементов.

Формула через ФВИ:  
$$
D_n = n! \left( 1 - \frac{1}{1!} + \frac{1}{2!} - \frac{1}{3!} + \ldots + (-1)^n \frac{1}{n!} \right).
$$

Доказательство:  
Всего перестановок: $n!$.  
Пусть $A_i$ — множество перестановок, где элемент $i$ остаётся на своём месте.  
Число перестановок, фиксирующих хотя бы один элемент:
$$
\sum_{i=1}^n |A_i| - \sum_{i<j} |A_i \cap A_j| + \ldots + (-1)^{n+1} |A_1 \cap \ldots \cap A_n|.
$$
Мощность $|A_{i_1} \cap \ldots \cap A_{i_k}| = (n - k)!$.  
Подставляя в ФВИ:
$$
D_n = n! - \binom{n}{1}(n-1)! + \binom{n}{2}(n-2)! - \ldots + (-1)^n \binom{n}{n}0!.
$$
Упрощая:
$$
D_n = n! \sum_{k=0}^n \frac{(-1)^k}{k!}.
$$


